steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.version)'
      architecture: 'x64'

  - script: python -m pip install --upgrade pip && pip install --upgrade tox
    displayName: Install dependencies

  - script: tox -e $(tox.env)
    env:
        TOX_AP_TEST_EXTRAS: azure-pipelines
    displayName: Run tox -e $(tox.env)

  #- script: |
      #if [ ! -f .coverage.* ]; then
        #echo No coverage data found.
        #exit 0
      #fi
      #coverage combine -a
      #coverage report
      #coverage xml
      #coverage html
    #displayName: 'Report code coverage'

  #- task: PublishTestResults@2
    #inputs:
      #testResultsFiles: '**/*test-results.xml'
      #testRunTitle: 'Python $(python.version)'
    #condition: succeededOrFailed()

  #- task: PublishCodeCoverageResults@1
    #inputs:
      #codeCoverageTool: Cobertura
      #summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/coverage.xml'
      #reportDirectory: '$(System.DefaultWorkingDirectory)/**/htmlcov'
